<html>
<head>
<title>Macker Guide: Using Macker with Ant</title>
<style>@import "../macker.css";</style>
</head>
<body>

<h1>Macker Guide</h1>

<div class="navbar">
<span class="next">Next:</span> <a href="../example/index.html">Examples</a> |
<a href="index.html">Table of Contents</a>
<br>
<a href="../index.html">Home</a> | 
<a href="../faq.html">FAQ</a> |
<a href="http://sourceforge.net/project/showfiles.php?group_id=55296">Download</a> |
<a href="http://sourceforge.net/projects/macker">Sourceforge page</a> |
<a href="../contact.html">Contact</a>
</div>

<h2>Using Macker with Ant</h2>
<ul class="pagecontents">
<li> <a href="#using">Using the Ant Task </a>
<li> <a href="#paramters">Parameters</a>
<li> <a href="#nested">Nested Elements</a>
<ul>
   <li> <a href="#rules">&lt;rules&gt;</a>
   <li> <a href="#classes">&lt;classes&gt;</a>
   <li> <a href="#var">&lt;var&gt;</a>
   <li> <a href="#classpath">&lt;classpath&gt;</a>
</ul>
<li> <a href="#example">An Example</a>
</ul>

<h3><a name="using">Declaring the Ant Task</a></h3>
<p>
Macker runs reasonably cooperatively as an Ant task.  Is is somewhat more cooperative running under Ant 1.5, which fixed a number of difficulties in the handling of classpaths for custom Ant tasks.  The rest of this page presumes Ant 1.5; if you are using an earlier version, you're on your own.
<p>
To use the Macker Ant task, you first need to declare it in a taskdef:
<pre>&lt;taskdef name="macker"
    classname="net.innig.macker.ant.MackerAntTask"
    classpath="<span class="comment">macker.jar and macker libs</span>"/&gt;</pre>
<p>
Specifying the classpath can be tedious, since Macker requires so many jars.  Fortunately, Ant provides a nice trick for this: you can assign a classpath to an Ant property, and use the property in the taskdef tag -- like so:
<pre>&lt;path id="macker.classpath"&gt;
    &lt;fileset dir="<span class="comment">dir with macker.jar and Macker libs</span>" /&gt;
&lt;/path&gt;
&lt;property name="macker.classpath" refid="macker.classpath" /&gt;
&lt;taskdef name="macker"
    classname="net.innig.macker.ant.MackerAntTask"
    classpath="${macker.classpath}"/&gt;</pre>
<p>
Once you're declared the macker task, you can use it in your Ant file with the options below.

<h3>Parameters</h3>
<table class="example-table" cellspacing=0>
<tr><th>Attribute</th><th>Description</th><th>Default</th></tr>
<tr valign="top">
<td class="example">fork</td>
<td>Should Macker run in its own JVM? As of version 0.3, the answer is probably "no", unless you encounter problems.</td>
<td>no</td>
</tr>
<tr valign="top">
<td class="example">failonerror</td>
<td>Should a Macker error will cause the Ant build to fail?</td>
<td>yes</td>
</tr>
<tr valign="top">
<td class="example">verbose</td>
<td>Instructs Macker to dump some information useful for debugging a rules file, including the complete set of references and classes matched by each pattern.</td>
<td>no</td>
</tr>
</table>

<h3><a name="nested">Nested Elements</a></h3>
<h4><a name="rules">&lt;rules&gt;</a></h4>
<p>
Specifies XML rules files.  Macker will apply each rules file in the fileset to the primary classes.
<p>
This tag uses the standard Ant fileset mechanisms.  An example:
<pre>&lt;rules dir="${src.dir}" includes="**/*macker*.xml" /&gt;</pre>

<h4><a name="classes">&lt;classes&gt;</a></h4>
<p>
Specifies the set of primary class files.  These are only the classes to which Macker's rules actually apply; you don't need to include libraries on which your classes depend.
<p>
Note that this tag specifies compiled class files -- not source files, and not jars.
<p>
Like <code>&lt;rules&gt;</code>, this tag is a fileset.  It typically won't look too much unlike this:
<p>
<pre>&lt;classes dir="${build.classes.dir}"&gt;
    &lt;include name="**/*.class" /&gt;
&lt;/classes&gt;
</pre>

<h4><a name="var">&lt;var&gt;</a></h4>
<p>
You can define variables for your rules files to use.  This tag has exactly the <a href="var-foreach.html#var">same syntax</a> in your Ant file as it does in a rules file -- you specify a name and a value attribute.
<p>
The Macker task does not automatically pass Ant properties through as Macker variables; you need to do this manually:
<pre>&lt;var name="base.package" value="${base.package}" /&gt;</pre>

<h4><a name="classpath">&lt;classpath&gt;</a></h4>
<p>
If you'd like Macker to be able to load information about classes other than the primary classes -- stuff from your libraries -- you can specify a custom classpath for Macker to look for classes used by the primary classes.

<h3><a name="example">An Example</a></h3>
<p>
Here, for your copy-and-pasting enjoyment, is a not entirely unreasonable starting point for your own Macker files.
<p>
<pre><span class="comment">&lt;!-- Declare a catch-all classpath for the project, its libs, and Macker --&gt;</span>
&lt;path id="build.classpath"&gt;
    &lt;pathelement location="${build.classes.dir}" /&gt;
&lt;/path&gt;
&lt;path id="macker.classpath"&gt;
    &lt;pathelement location="${build.classes.dir}" /&gt;
    &lt;fileset dir="${lib.dir}" /&gt;
    &lt;fileset dir="${macker.lib.dir}" /&gt;
&lt;/path&gt;
&lt;property name="macker.classpath" refid="macker.classpath" /&gt;

<span class="comment">&lt;!-- Declare the Macker task --&gt;</span>
&lt;taskdef name="macker"
    classname="net.innig.macker.ant.MackerAntTask"
    classpath="${macker.classpath}" /&gt;

<span class="comment">&lt;!-- Run the darn thing! --&gt;</span>
&lt;macker&gt;
    &lt;rules dir="${src.dir}" includes="**/*macker*.xml" /&gt;
    &lt;classes dir="${build.classes.dir}"&gt;
        &lt;include name="**/*.class" /&gt;
    &lt;/classes&gt;
    &lt;var name="basepkg" value="com.vaporcorp" /&gt;
    &lt;classpath refid="build.classpath" /&gt;
&lt;/macker&gt;</pre>
<p>
Congratulations!  You have now completed the Macker Online Training Course.  If you wish, you may print this page as evidence of your certification and post it on your wall.  Feel free to <a href="../contact.html">contact me</a> with questions -- I'd love to know that people are interested in the project!

<div class="next">
Next: <a href="../example/index.html">Examples</a>
</div>

<div class="footer">
<div class="navbar">
<span class="next">Next:</span> <a href="../example/index.html">Examples</a> |
<a href="index.html">Table of Contents</a>
<br>
<a href="../index.html">Home</a> | 
<a href="../faq.html">FAQ</a> |
<a href="http://sourceforge.net/project/showfiles.php?group_id=55296">Download</a> |
<a href="http://sourceforge.net/projects/macker">Sourceforge page</a> |
<a href="../contact.html">Contact</a>
</div>
</div>
<p align="right">
<A href="http://sourceforge.net"><IMG src="http://sourceforge.net/sflogo.php?group_id=55296" width="88" height="31" border="0" alt="SourceForge Logo"></A>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://innig.net/?logo"><img border=0 src="http://innig.net/images/innig_3C0000.gif"></a>

</body>
</html>

